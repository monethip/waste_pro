(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d16c4120"],{"089b":function(t,e,a){},"13c8":function(t,e,a){"use strict";a.r(e);var s=a("8447"),r=a("07b0"),o=a("db5a"),n=a("0f35"),i=a("1da9"),l=a("1789"),c=a("0cb6"),d=a("565c"),u=a("1d7d"),m=a("d62f"),h=a("cfe2"),f=a("9b44"),p=function(){var t=this,e=t._self._c;return e(l["a"],[e(s["a"],{staticClass:"mt-n4",attrs:{large:""}},[e(r["a"],{staticClass:"text-primary",attrs:{text:""},on:{click:function(e){return t.backPrevios()}}},[e(u["a"],[t._v("mdi-keyboard-backspace")])],1),t._v("ເພີ່ມແຜນເສັ້ນທາງ "),e(h["a"]),e("span",{staticClass:"mr-4"},[e(u["a"],{attrs:{color:"red"}},[t._v("mdi-map-marker")]),t._v("ຍັງບໍທັນຢູ່ໃນແຜນ ")],1),e("span",[e(u["a"],{staticStyle:{color:"#49a3da"}},[t._v("mdi-map-marker")]),t._v("ຢູ່ໃນແຜນແລ້ວ ")],1)],1),e(m["a"],[e(i["a"],{staticClass:"mb-4",attrs:{cols:"12"}},[t.customers?e("GmapMap",{staticStyle:{width:"100%",height:"400px"},attrs:{center:t.getCenter().lat>0||t.getCenter().lat<0?t.getCenter():{lat:0,lng:0},zoom:16,"disable-default-u-i":!0}},[e("gmap-info-window",{attrs:{options:t.infoOptions,position:t.infoPosition,opened:t.infoOpened,conent:t.infoContent},on:{closeclick:function(e){t.infoOpened=!1}}},[t._v(" "+t._s(t.infoContent)+" ")]),t._l(t.customers,(function(a,s){return e("GmapMarker",{key:s,attrs:{position:t.getMarkers(a),draggable:!1,icon:t.getSiteIcon(a),animation:2,clickable:!0,label:(s+1).toString()},on:{click:function(e){return t.toggleInfo(a,s)}}})}))],2):t._e()],1)],1),e(m["a"],{staticClass:"mb-n6"},[e(i["a"],[e(r["a"],{staticClass:"btn-primary",attrs:{loading:t.loading,disabled:t.loading},on:{click:function(e){return t.createRoutePlan()}}},[t._v(" ບັນທຶກ "),e(u["a"],[t._v("mdi-content-save")])],1)],1),e(i["a"],[t.customers?e("h4",[t._v(" ຈັດລຽນລຳດັບການເກັບຂີ້ເຫື້ຍອລູກຄ້າ "+t._s(t.customers.length)+" ຄົນ ")]):t._e()]),e(i["a"],[e(f["a"],{attrs:{outlined:"",dense:"",clearable:"","prepend-inner-icon":"mdi-magnify",label:"ຊື່ລູກຄ້າ",type:"text"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.Search()}},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)],1),e("div",[e(o["a"],[e(n["b"],[e("main",{staticClass:"page page--table"},[e(c["a"],{staticClass:"page__table",attrs:{headers:t.headers,items:t.customers,search:t.search,"disable-pagination":!0,"hide-default-footer":"","item-key":"id"},scopedSlots:t._u([{key:"body",fn:function(a){return[e("draggable",{attrs:{list:a.items,tag:"tbody"},on:{change:t.afterAdd}},t._l(a.items,(function(a,s){return e("tr",{key:s},[e("td",[e(u["a"],{staticClass:"page__grab-icon",attrs:{small:""}},[t._v(" mdi-arrow-all ")])],1),e("td",[t._v(t._s(s+1))]),e("td",[t._v(t._s(a.id))]),e("td",[t._v(t._s(a.company_name))]),e("td",[t._v(t._s(a.user.phone))]),e("td",[t._v(" "+t._s(a.expect_trash?Intl.NumberFormat().format(a.expect_trash)+t.getCustomerUnitFunc(a.cost_by):"-")+" ")]),e("td",[t._v(t._s(a.created_at))]),e("td",[t._v(t._s(a.village.name))]),e("td",[t._v(t._s(a.district.name))]),e("td",[t._v(t._s(a.collect_description))]),e("td",[e(u["a"],{attrs:{small:""},on:{click:function(e){return t.deleteItem(s)}}},[t._v(" mdi-delete ")])],1)])})),0)]}}]),model:{value:t.selectedRows,callback:function(e){t.selectedRows=e},expression:"selectedRows"}})],1)])],1)],1),e("ModalAdd",[[e(o["a"],[e(n["c"],[e("span",{staticClass:"headline"},[t._v("Route Plan Name")])]),e(n["b"],[e(l["a"],[e(d["a"],{ref:"form",attrs:{"lazy-validation":""}},[e(m["a"],[e(i["a"],{attrs:{cols:"12"}},[e(f["a"],{attrs:{label:"Name *",required:""},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),e("p",{staticClass:"errors"},[t._v(" "+t._s(t.server_errors.name)+" ")])],1)],1)],1)],1),e(n["a"],[e(h["a"]),e(r["a"],{attrs:{color:"blue darken-1",text:""},on:{click:function(e){return t.closeAddModal()}}},[t._v(" Close ")]),e(r["a"],{attrs:{color:"blue darken-1",text:"",loading:t.loading,disabled:t.loading},on:{click:function(e){return t.saveRoutePlan()}}},[t._v(" Save ")])],1)],1)],1)]],2),e("ModalDelete",[[e(n["a"],[e(h["a"]),e(r["a"],{attrs:{color:"blue darken-1",text:""},on:{click:t.closeDelete}},[t._v(" Cancel ")]),e(r["a"],{attrs:{color:"blue darken-1",text:"",loading:t.loading,disabled:t.loading},on:{click:t.deleteItemConfirm}},[t._v(" OK ")]),e(h["a"])],1)]],2)],1)},g=[],_=(a("558b"),a("6ece")),v=a("ce7d"),b=a.n(v),x=a("7660"),w={name:"Customer",components:{draggable:b.a},props:["selectedData","villages","items"],data(){return{customers:[],customersId:[],countcutomer:0,loading:!1,customerId:"",search:"",oldVal:"",selectedVillage:[],selectedCustomer:[],exclude_customers:[],selectedRows:[],customer:{},customerIndex:"",name:"",server_errors:{},headers:[{text:"",value:""},{text:"#",value:""},{text:"Id",value:"id"},{text:"ບໍລິສັດ",value:"company_name"},{text:"Phone",value:"user.phone",sortable:!1},{text:"ຂີ້ເຫຍື້ອຄາດໝາຍ",value:"expect_trash"},{text:"ວັນທີ່ເພີ່ມເຂົ້າ",value:"created_at"},{text:"ບ້ານ",value:"village.name",sortable:!0},{text:"ເມືອງ",value:"district.name",sortable:!0},{text:"ລາຍລະອຽດການບໍລິການ",value:"collect_description",sortable:!0},{text:"",value:"actions",sortable:!1}],latlng:{lat:0,lng:0},markers:[],infoPosition:null,infoContent:null,infoOpened:!1,infoCurrentKey:null,infoOptions:{pixelOffset:{width:0,height:-35}}}},watch:{search(t){""==t&&this.fetchData()}},created(){this.fetchData()},methods:{getCustomerUnitFunc(t){return Object(x["e"])(t)},afterAdd(t){const{oldIndex:e}=t.moved,{newIndex:a}=t.moved,s=this.customers[e];this.customers.splice(e,1),this.customers.splice(a,0,s)},backPrevios(){this.$router.go(-1)},fetchData(){this.customers=this.items,this.selectedVillage=this.villages},closeDelete(){this.$store.commit("modalDelete_State",!1)},deleteItem(t){this.customerIndex=t,this.$store.commit("modalDelete_State",!0)},deleteItemConfirm(){this.selectedCustomer=[],this.$store.commit("Loading_State",!0),this.customers.splice(this.customerIndex,1),this.selectedCustomer.filter(t=>{this.exclude_customers.push(t.id)}),this.$store.commit("Toast_State",{value:!0,color:"success",msg:"ລຶບຂໍ້ມູນສຳເລັດແລ້ວ"}),this.selectedRows=[],this.fetchData(),this.$store.commit("Loading_State",!1),this.$store.commit("modalDelete_State",!1)},createRoutePlan(){this.$store.commit("modalAdd_State",!0)},closeAddModal(){this.$store.commit("modalAdd_State",!1)},saveRoutePlan(){const t=[];this.customers.map(e=>{t.push(e.id)}),this.customers.length?(this.$store.commit("Loading_State",!0),this.$axios.post("create-route-plan",{name:this.name,customers:t},{responseType:"blob"}).then(t=>{200==t.status&&(setTimeout(()=>{this.$store.commit("Loading_State",!1)},300),this.$router.push({name:"Plan"}))}).catch(t=>{this.$store.commit("Toast_State",{value:!0,color:"error",msg:t.response?t.response.data.message:"Something went wrong"}),this.$store.commit("Loading_State",!1)})):this.$store.commit("Toast_State",{value:!0,color:"error",msg:"ກາລຸນາເລືອກລູກຄ້າກ່ອນ"})},viewPage(t){this.$router.push({name:"ViewClient",params:{id:t}})},Search(){Object(_["a"])(this)},getCenter(){if(this.customers.length){if(null==parseFloat(this.customers[0].lat))return console.log(this.latlng),this.latlng;const t={lat:parseFloat(this.customers[0].lat),lng:parseFloat(this.customers[0].lng)};return t}return this.latlng},getSiteIcon(t){const e={url:a("347c"),zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,disableDefaultUi:!1,size:{width:35,height:55,f:"px",b:"px"},scaledSize:{width:35,height:55,f:"px",b:"px"}},s={url:a("f742"),zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,disableDefaultUi:!1,size:{width:35,height:55,f:"px",b:"px"},color:"#000",scaledSize:{width:35,height:55,f:"px",b:"px"}};try{switch(t.route_plan_details_count){case 0:return e;case 1:return s}}catch(r){return e}},getMarkers(t){if(null!==t.customer)return{lat:parseFloat(t.lat),lng:parseFloat(t.lng)}},toggleInfo(t,e){this.infoPosition=this.getMarkers(t),this.infoContent=`${t.company_name} (${t.village.name}) `,this.infoCurrentKey==e?this.infoOpened=!this.infoOpened:(this.infoOpened=!0,this.infoCurrentKey=e)},rowClicked(t){this.toggleSelection(t.id),console.log(t)},toggleSelection(t){this.selectedRows.includes(t)?this.selectedRows=this.selectedRows.filter(e=>e!==t):this.selectedRows.push(t)}}},C=w,k=(a("fc53"),a("4a4e")),y=Object(k["a"])(C,p,g,!1,null,null,null);e["default"]=y.exports},"347c":function(t,e,a){t.exports=a.p+"img/pin1.d74f27bd.svg"},"565c":function(t,e,a){"use strict";a("558b");var s=a("9c0c"),r=a("68c4"),o=a("944a");e["a"]=Object(s["a"])(r["a"],Object(o["b"])("form")).extend({name:"v-form",provide(){return{form:this}},inheritAttrs:!1,props:{disabled:Boolean,lazyValidation:Boolean,readonly:Boolean,value:Boolean},data:()=>({inputs:[],watchers:[],errorBag:{}}),watch:{errorBag:{handler(t){const e=Object.values(t).includes(!0);this.$emit("input",!e)},deep:!0,immediate:!0}},methods:{watchInput(t){const e=t=>t.$watch("hasError",e=>{this.$set(this.errorBag,t._uid,e)},{immediate:!0}),a={_uid:t._uid,valid:()=>{},shouldValidate:()=>{}};return this.lazyValidation?a.shouldValidate=t.$watch("shouldValidate",s=>{s&&(this.errorBag.hasOwnProperty(t._uid)||(a.valid=e(t)))}):a.valid=e(t),a},validate(){return 0===this.inputs.filter(t=>!t.validate(!0)).length},reset(){this.inputs.forEach(t=>t.reset()),this.resetErrorBag()},resetErrorBag(){this.lazyValidation&&setTimeout(()=>{this.errorBag={}},0)},resetValidation(){this.inputs.forEach(t=>t.resetValidation()),this.resetErrorBag()},register(t){this.inputs.push(t),this.watchers.push(this.watchInput(t))},unregister(t){const e=this.inputs.find(e=>e._uid===t._uid);if(!e)return;const a=this.watchers.find(t=>t._uid===e._uid);a&&(a.valid(),a.shouldValidate()),this.watchers=this.watchers.filter(t=>t._uid!==e._uid),this.inputs=this.inputs.filter(t=>t._uid!==e._uid),this.$delete(this.errorBag,e._uid)}},render(t){return t("form",{staticClass:"v-form",attrs:{novalidate:!0,...this.attrs$},on:{submit:t=>this.$emit("submit",t)}},this.$slots.default)}})},7660:function(t,e,a){"use strict";a.d(e,"g",(function(){return s})),a.d(e,"c",(function(){return r})),a.d(e,"h",(function(){return o})),a.d(e,"e",(function(){return n})),a.d(e,"f",(function(){return i})),a.d(e,"a",(function(){return l})),a.d(e,"b",(function(){return c})),a.d(e,"d",(function(){return d}));a("558b");const s=function(t){switch(t){case"container":return"ຄອນເທນເນີ";case"fix_cost":return"ເປັນຖ້ຽວ";case"chartered":return"ມອບເໝົາ";case"bag":return"ບໍລິມາດ";case"infect":return"ຂີ້ເຫຍື້ອຕິດເຊື້ອ";case"32km":return"ຫຼັກ32";default:return t}},r=[{en:"container",la:"ຄອນເທນເນີ"},{en:"fix_cost",la:"ເປັນຖ້ຽວ"},{en:"chartered",la:"ມອບເໝົາ"},{en:"bag",la:"ບໍລິມາດ"},{en:"infect",la:"ຂີ້ເຫຍື້ອຕິດເຊື້ອ"},{en:"32km",la:"ຫຼັກ32"}],o=function(t){switch(t){case"company":return"ຫົວໜ່ວຍທຸລະກິດ";case"home":return"ຄົວເຮືອນ";default:return t}},n=function(t){switch(t){case"bag":case"chartered":case"32km":case"infect":return"ຖົງ";case"container":return"ຄອນເທນເນີ";case"fix_cost":return"ຖ້ຽວ";default:return t}},i=[{en:"requested",la:"ລູກຄ້າຮ້ອງຂໍເຂົ້າມາ",color:"#34495e"},{en:"rejected",la:"ປະຕິເສດລູກຄ້າແລ້ວ",color:"#eff3f5"},{en:"approved",la:"ອະນຸມັດແລ້ວ ລໍຖ້າລົງເກັບ",color:"#54a0ff"},{en:"collected",la:"ເກັບແລ້ວ ລໍຖ້າຢືນຢັນ",color:"#c1c40f"},{en:"collect_confirm",la:"ລູກຄ້າຢືນຢັນການເກັບແລ້ວ",color:"#30cb83"},{en:"collect_reject",la:"ລູກຄ້າປະຕິເສດການເກັບ",color:"#e74c3c"}],l=[{text:"ວັນທີຈ່າຍບິນ",value:"paided_at"},{text:"ວັນທີສ້າງບິນ",value:"created_at"},{text:"ວັນທີອະນຸມັດບິນ",value:"approved_at"},{text:"ວັນທີກວດສອບບິນສຳເລັດ",value:"confirmed_payment_at"}],c=(t=[])=>{const e=[];for(const a of t)e.push({id:a.id,name:`${a.name} (${Intl.NumberFormat().format(a.price)} ກີບ)`});return e},d=[{value:"",text:"ທັງໝົດ"},{value:"can",text:"ເກັບໄດ້"},{value:"not",text:"ເກັບບໍ່ໄດ້"}]},f742:function(t,e,a){t.exports=a.p+"img/pin2.b23d8eec.svg"},fc53:function(t,e,a){"use strict";a("089b")}}]);
//# sourceMappingURL=chunk-d16c4120.66be510a.js.map