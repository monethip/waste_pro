(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5da4a16c"],{"13c8":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",[n("v-breadcrumbs",{staticClass:"mt-n4",attrs:{large:""}},[n("v-btn",{staticClass:"text-primary",attrs:{text:""},on:{click:function(e){return t.backPrevios()}}},[n("v-icon",[t._v("mdi-keyboard-backspace ")])],1),t._v(" ເພີ່ມແຜນເສັ້ນທາງ "),n("v-spacer"),n("span",{staticClass:"mr-4"},[n("v-icon",{attrs:{color:"red"}},[t._v("mdi-map-marker")]),t._v("ຍັງບໍທັນຢູ່ໃນແຜນ ")],1),n("span",[n("v-icon",{staticStyle:{color:"#49a3da"}},[t._v("mdi-map-marker")]),t._v("ຢູ່ໃນແຜນແລ້ວ ")],1)],1),n("v-row",[n("v-col",{staticClass:"mb-4",attrs:{cols:"12"}},[t.customers?n("GmapMap",{staticStyle:{width:"100%",height:"400px"},attrs:{center:t.getCenter(),zoom:16,disableDefaultUI:!0}},[n("gmap-info-window",{attrs:{options:t.infoOptions,position:t.infoPosition,opened:t.infoOpened,conent:t.infoContent},on:{closeclick:function(e){t.infoOpened=!1}}},[t._v(t._s(t.infoContent)+" ")]),t._l(t.customers,(function(e,a){return n("GmapMarker",{key:a,attrs:{position:t.getMarkers(e),draggable:!1,icon:t.getSiteIcon(e),animation:2,clickable:!0,label:(a+1).toString()},on:{click:function(n){return t.toggleInfo(e,a)}}})}))],2):t._e()],1)],1),n("v-row",{staticClass:"mb-n6"},[n("v-col",[n("v-btn",{staticClass:"btn-primary",attrs:{loading:t.loading,disabled:t.loading},on:{click:function(e){return t.createRoutePlan()}}},[t._v(" ບັນທຶກ"),n("v-icon",[t._v("mdi-content-save")])],1)],1),n("v-col",[t.customers?n("h4",[t._v(" ຈັດລຽນລຳດັບການເກັບຂີ້ເຫື້ຍອລູກຄ້າ "+t._s(t.customers.length)+" ຄົນ ")]):t._e()]),n("v-col",[n("v-text-field",{attrs:{outlined:"",dense:"",clearable:"","prepend-inner-icon":"mdi-magnify",label:"ຊື່ລູກຄ້າ",type:"text"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.Search()}},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)],1),n("div",[n("v-card",[n("v-card-text",[n("main",{staticClass:"page page--table"},[n("v-data-table",{staticClass:"page__table",attrs:{headers:t.headers,items:t.customers,search:t.search,"disable-pagination":!0,"hide-default-footer":"","item-key":"id"},scopedSlots:t._u([{key:"body",fn:function(e){return[n("draggable",{attrs:{list:e.items,tag:"tbody"},on:{change:t.afterAdd}},t._l(e.items,(function(e,a){return n("tr",{key:a},[n("td",[n("v-icon",{staticClass:"page__grab-icon",attrs:{small:""}},[t._v(" mdi-arrow-all ")])],1),n("td",[t._v(t._s(a+1))]),n("td",[t._v(t._s(e.id))]),n("td",[t._v(t._s(e.company_name))]),n("td",[t._v(t._s(e.user.phone))]),n("td",[t._v(t._s(e.expect_trash?Intl.NumberFormat().format(e.expect_trash)+t.getCustomerUnitFunc(e.cost_by):"-"))]),n("td",[t._v(t._s(e.created_at))]),n("td",[t._v(t._s(e.village.name))]),n("td",[t._v(t._s(e.district.name))]),n("td",[t._v(t._s(e.collect_description))]),n("td",[n("v-icon",{attrs:{small:""},on:{click:function(e){return t.deleteItem(a)}}},[t._v(" mdi-delete ")])],1)])})),0)]}}]),model:{value:t.selectedRows,callback:function(e){t.selectedRows=e},expression:"selectedRows"}})],1)])],1)],1),n("ModalAdd",[[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline"},[t._v("Route Plan Name")])]),n("v-card-text",[n("v-container",[n("v-form",{ref:"form",attrs:{"lazy-validation":""}},[n("v-row",[n("v-col",{attrs:{cols:"12"}},[n("v-text-field",{attrs:{label:"Name *",required:""},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),n("p",{staticClass:"errors"},[t._v(" "+t._s(t.server_errors.name)+" ")])],1)],1)],1)],1),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(e){return t.closeAddModal()}}},[t._v(" Close ")]),n("v-btn",{attrs:{color:"blue darken-1",text:"",loading:t.loading,disabled:t.loading},on:{click:function(e){return t.saveRoutePlan()}}},[t._v(" Save ")])],1)],1)],1)]],2),n("ModalDelete",[[n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:t.closeDelete}},[t._v("Cancel")]),n("v-btn",{attrs:{color:"blue darken-1",text:"",loading:t.loading,disabled:t.loading},on:{click:t.deleteItemConfirm}},[t._v("OK")]),n("v-spacer")],1)]],2)],1)},o=[],r=(n("a434"),n("4de4"),n("d81d"),n("b0c0"),n("caad"),n("2532"),n("6eceb")),s=n("b76a"),i=n.n(s),c=n("7660"),l={name:"Customer",props:["selectedData","villages","items"],components:{draggable:i.a},data:function(){return{customers:[],customersId:[],countcutomer:0,loading:!1,customerId:"",search:"",oldVal:"",selectedVillage:[],selectedCustomer:[],exclude_customers:[],selectedRows:[],customer:{},customerIndex:"",name:"",server_errors:{},headers:[{text:"",value:""},{text:"#",value:""},{text:"Id",value:"id"},{text:"ບໍລິສັດ",value:"company_name"},{text:"Phone",value:"user.phone",sortable:!1},{text:"ຂີ້ເຫຍື້ອຄາດໝາຍ",value:"expect_trash"},{text:"ວັນທີ່ເພີ່ມເຂົ້າ",value:"created_at"},{text:"ບ້ານ",value:"village.name",sortable:!0},{text:"ເມືອງ",value:"district.name",sortable:!0},{text:"ລາຍລະອຽດການບໍລິການ",value:"collect_description",sortable:!0},{text:"",value:"actions",sortable:!1}],latlng:{lat:18.1189434,lng:102.290218},markers:[],infoPosition:null,infoContent:null,infoOpened:!1,infoCurrentKey:null,infoOptions:{pixelOffset:{width:0,height:-35}}}},methods:{getCustomerUnitFunc:function(t){return Object(c["b"])(t)},afterAdd:function(t){var e=t.moved.oldIndex,n=t.moved.newIndex,a=this.customers[e];this.customers.splice(e,1),this.customers.splice(n,0,a)},backPrevios:function(){this.$router.go(-1)},fetchData:function(){this.customers=this.items,this.selectedVillage=this.villages},closeDelete:function(){this.$store.commit("modalDelete_State",!1)},deleteItem:function(t){this.customerIndex=t,this.$store.commit("modalDelete_State",!0)},deleteItemConfirm:function(){var t=this;this.selectedCustomer=[],this.loading=!0,this.customers.splice(this.customerIndex,1),this.selectedCustomer.filter((function(e){t.exclude_customers.push(e.id)})),this.$store.commit("Toast_State",{value:!0,color:"success",msg:"ລຶບຂໍ້ມູນສຳເລັດແລ້ວ"}),this.selectedRows=[],this.fetchData(),this.loading=!1,this.$store.commit("modalDelete_State",!1)},createRoutePlan:function(){this.$store.commit("modalAdd_State",!0)},closeAddModal:function(){this.$store.commit("modalAdd_State",!1)},saveRoutePlan:function(){var t=this,e=[];this.customers.map((function(t){e.push(t.id)})),this.customers.length>0?(this.loading=!0,this.$axios.post("create-route-plan",{name:this.name,customers:e},{responseType:"blob"}).then((function(e){200==e.status&&(setTimeout((function(){t.loading=!1}),300),t.$router.push({name:"Plan"}))})).catch((function(e){t.$store.commit("Toast_State",{value:!0,color:"error",msg:e.response.data.message}),t.loading=!1}))):this.$store.commit("Toast_State",{value:!0,color:"error",msg:"ກາລຸນາເລືອກລູກຄ້າກ່ອນ"})},viewPage:function(t){this.$router.push({name:"ViewCustomer",params:{id:t}})},Search:function(){Object(r["a"])(this)},getCenter:function(){if(this.customers.length){if(null==parseFloat(this.customers[0].lat))return console.log(this.latlng),this.latlng;var t={lat:parseFloat(this.customers[0].lat),lng:parseFloat(this.customers[0].lng)};return t}return this.latlng},getSiteIcon:function(t){var e={url:n("347c"),zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,disableDefaultUi:!1,size:{width:35,height:55,f:"px",b:"px"},scaledSize:{width:35,height:55,f:"px",b:"px"}},a={url:n("f742"),zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,disableDefaultUi:!1,size:{width:35,height:55,f:"px",b:"px"},color:"#000",scaledSize:{width:35,height:55,f:"px",b:"px"}};try{switch(t.route_plan_details_count){case 0:return e;case 1:return a}}catch(o){return e}},getMarkers:function(t){if(null!==t.customer)return{lat:parseFloat(t.lat),lng:parseFloat(t.lng)}},toggleInfo:function(t,e){this.infoPosition=this.getMarkers(t),this.infoContent=t.company_name+" ("+t.village.name+") ",this.infoCurrentKey==e?this.infoOpened=!this.infoOpened:(this.infoOpened=!0,this.infoCurrentKey=e)},rowClicked:function(t){this.toggleSelection(t.id),console.log(t)},toggleSelection:function(t){this.selectedRows.includes(t)?this.selectedRows=this.selectedRows.filter((function(e){return e!==t})):this.selectedRows.push(t)}},watch:{search:function(t){""==t&&this.fetchData()}},created:function(){this.fetchData()}},u=l,d=(n("5ebb"),n("2877")),f=n("6544"),h=n.n(f),m=n("2bc5"),v=n("8336"),p=n("b0af"),g=n("99d9"),_=n("62ad"),b=n("a523"),x=n("8fea"),C=n("4bd4"),w=n("132d"),k=n("0fd9"),y=n("2fa4"),V=n("8654"),S=Object(d["a"])(u,a,o,!1,null,null,null);e["default"]=S.exports;h()(S,{VBreadcrumbs:m["a"],VBtn:v["a"],VCard:p["a"],VCardActions:g["a"],VCardText:g["b"],VCardTitle:g["c"],VCol:_["a"],VContainer:b["a"],VDataTable:x["a"],VForm:C["a"],VIcon:w["a"],VRow:k["a"],VSpacer:y["a"],VTextField:V["a"]})},2243:function(t,e,n){},"347c":function(t,e,n){t.exports=n.p+"img/pin1.d74f27bd.svg"},"4bd4":function(t,e,n){"use strict";var a=n("5530"),o=(n("caad"),n("2532"),n("07ac"),n("4de4"),n("159b"),n("7db0"),n("58df")),r=n("7e2b"),s=n("3206");e["a"]=Object(o["a"])(r["a"],Object(s["b"])("form")).extend({name:"v-form",provide:function(){return{form:this}},inheritAttrs:!1,props:{disabled:Boolean,lazyValidation:Boolean,readonly:Boolean,value:Boolean},data:function(){return{inputs:[],watchers:[],errorBag:{}}},watch:{errorBag:{handler:function(t){var e=Object.values(t).includes(!0);this.$emit("input",!e)},deep:!0,immediate:!0}},methods:{watchInput:function(t){var e=this,n=function(t){return t.$watch("hasError",(function(n){e.$set(e.errorBag,t._uid,n)}),{immediate:!0})},a={_uid:t._uid,valid:function(){},shouldValidate:function(){}};return this.lazyValidation?a.shouldValidate=t.$watch("shouldValidate",(function(o){o&&(e.errorBag.hasOwnProperty(t._uid)||(a.valid=n(t)))})):a.valid=n(t),a},validate:function(){return 0===this.inputs.filter((function(t){return!t.validate(!0)})).length},reset:function(){this.inputs.forEach((function(t){return t.reset()})),this.resetErrorBag()},resetErrorBag:function(){var t=this;this.lazyValidation&&setTimeout((function(){t.errorBag={}}),0)},resetValidation:function(){this.inputs.forEach((function(t){return t.resetValidation()})),this.resetErrorBag()},register:function(t){this.inputs.push(t),this.watchers.push(this.watchInput(t))},unregister:function(t){var e=this.inputs.find((function(e){return e._uid===t._uid}));if(e){var n=this.watchers.find((function(t){return t._uid===e._uid}));n&&(n.valid(),n.shouldValidate()),this.watchers=this.watchers.filter((function(t){return t._uid!==e._uid})),this.inputs=this.inputs.filter((function(t){return t._uid!==e._uid})),this.$delete(this.errorBag,e._uid)}}},render:function(t){var e=this;return t("form",{staticClass:"v-form",attrs:Object(a["a"])({novalidate:!0},this.attrs$),on:{submit:function(t){return e.$emit("submit",t)}}},this.$slots.default)}})},"5ebb":function(t,e,n){"use strict";n("2243")},7660:function(t,e,n){"use strict";n.d(e,"d",(function(){return a})),n.d(e,"a",(function(){return o})),n.d(e,"e",(function(){return r})),n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return i}));var a=function(t){switch(t){case"container":return"ຄອນເທນເນີ";case"fix_cost":return"ເປັນຖ້ຽວ";case"chartered":return"ມອບເໝົາ";case"bag":return"ບໍລິມາດ";default:return t}},o=[{en:"container",la:"ຄອນເທນເນີ"},{en:"fix_cost",la:"ເປັນຖ້ຽວ"},{en:"chartered",la:"ມອບເໝົາ"},{en:"bag",la:"ບໍລິມາດ"}],r=function(t){switch(t){case"company":return"ຫົວໜ່ວຍທຸລະກິດ";case"home":return"ຄົວເຮືອນ";default:return t}},s=function(t){switch(t){case"bag":case"chartered":return"ຖົງ";case"container":return"ຄອນເທນເນີ";case"fix_cost":return"ຖ້ຽວ";default:return t}},i=[{en:"requested",la:"ລູກຄ້າຮ້ອງຂໍເຂົ້າມາ",color:"#34495e"},{en:"rejected",la:"ປະຕິເສດລູກຄ້າແລ້ວ",color:"#eff3f5"},{en:"approved",la:"ອະນຸມັດແລ້ວ ລໍຖ້າລົງເກັບ",color:"#54a0ff"},{en:"collected",la:"ເກັບແລ້ວ ລໍຖ້າຢືນຢັນ",color:"#c1c40f"},{en:"collect_confirm",la:"ລູກຄ້າຢືນຢັນການເກັບແລ້ວ",color:"#30cb83"},{en:"collect_reject",la:"ລູກຄ້າປະຕິເສດການເກັບ",color:"#e74c3c"}]},f742:function(t,e,n){t.exports=n.p+"img/pin2.b23d8eec.svg"}}]);
//# sourceMappingURL=chunk-5da4a16c.c920085d.js.map